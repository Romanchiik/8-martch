<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA / Fullscreen Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-fullscreen">
    <meta name="apple-mobile-web-app-title" content="–° 8 –ú–∞—Ä—Ç–∞">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1a2456">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <title>–° 8 –ú–∞—Ä—Ç–∞! üå∏</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #0a1128 0%, #1a2456 50%, #2d3561 100%);
            color: white;
            touch-action: none;
        }

        #root {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .lang-switcher {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 8px 16px;
            display: flex;
            gap: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .lang-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .lang-btn.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .lang-btn:hover {
            transform: scale(1.1);
        }

        .video-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 999;
            background: #0a1128;
        }

        .video-transition video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-placeholder {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, 
                #ff6b9d 0%, 
                #ffc371 25%, 
                #ff6b9d 50%, 
                #c471ed 75%, 
                #ff6b9d 100%
            );
            background-size: 100% 400%;
            animation: gradientFlow 3s ease-in-out infinite;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 50% 0%; }
            50% { background-position: 50% 100%; }
        }

        .placeholder-text {
            font-size: 2rem;
            font-family: 'Pacifico', cursive;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .room-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            position: relative;
            overflow: hidden;
        }

        .room-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
        }

        .flower {
            position: absolute;
            font-size: 2.5rem;
            animation: float 6s ease-in-out infinite;
            opacity: 0.4;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        .room-content {
            z-index: 1;
            text-align: center;
            max-width: 90vw;
            max-height: 90vh;
            overflow: visible;
        }

        .room-title {
            font-size: clamp(1.3rem, 4vw, 2rem);
            margin-bottom: 0.8rem;
            font-weight: 700;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
            line-height: 1.3;
            padding: 0 1rem;
        }

        .room-hint {
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            margin-bottom: 1.5rem;
            opacity: 0.9;
            padding: 0 1rem;
        }

        /* Room 1: Slingshot */
        .slingshot-container {
            position: relative;
            width: min(400px, 90vw);
            height: min(600px, 65vh);
            margin: 0 auto;
        }

        .heart {
            position: absolute;
            font-size: 3rem;
            cursor: grab;
            user-select: none;
            filter: drop-shadow(0 0 10px rgba(255, 107, 157, 0.8));
            z-index: 10;
            touch-action: none;
        }

        .heart:active {
            cursor: grabbing;
        }

        @keyframes targetPulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }

        /* Room 2: Hold Button */
        .hold-button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .hold-button {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b9d, #ffc371);
            border: none;
            font-size: 4rem;
            cursor: pointer;
            transition: transform 0.2s;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.5);
            position: relative;
        }

        .hold-button:active {
            transform: scale(0.95);
        }

        .progress-ring {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 220px;
            height: 220px;
        }

        .progress-ring-circle {
            stroke: #FFD700;
            stroke-width: 8;
            fill: none;
            stroke-dasharray: 691.15;
            stroke-dashoffset: 691.15;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.1s linear;
        }

        .timer-display {
            font-size: 3rem;
            font-weight: 900;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        /* Room 3: Shake Phone */
        .shake-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .cloud {
            font-size: 8rem;
            position: relative;
            animation: cloudFloat 3s ease-in-out infinite;
        }

        @keyframes cloudFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes fall {
            from {
                top: 30%;
                opacity: 1;
                transform: rotate(0deg);
            }
            to {
                top: 90%;
                opacity: 0;
                transform: rotate(360deg);
            }
        }

        @keyframes fallFromCloud {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(calc(-50% + var(--end-x)), 60vh) rotate(var(--rotation));
                opacity: 0;
            }
        }

        .shake-counter {
            font-size: 2rem;
            font-weight: 700;
            color: #FFD700;
        }

        /* Room 4: Find Button */
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 280px;
            margin: 0 auto;
            justify-items: center;
        }

        .game-button {
            width: 85px;
            height: 85px;
            border-radius: 15px;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .game-button.wrong {
            animation: wiggle 0.5s ease-in-out;
        }

        @keyframes wiggle {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .game-button.correct {
            background: linear-gradient(135deg, #FFD700, #FFA500) !important;
            animation: correctPulse 0.5s ease-in-out;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8) !important;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Room 5: Final */
        .final-flower {
            font-size: 10rem;
            cursor: pointer;
            animation: finalFlowerGrow 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 107, 157, 0.8));
        }

        @keyframes finalFlowerGrow {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        .final-message {
            font-family: 'Pacifico', cursive;
            font-size: 3rem;
            margin-top: 2rem;
            text-shadow: 0 0 30px rgba(255, 107, 157, 0.8);
            animation: fadeInUp 1s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ff6b9d;
            animation: confettiFall 3s linear forwards;
            pointer-events: none;
        }

        @keyframes confettiFall {
            from {
                top: -10px;
                opacity: 1;
                transform: rotate(0deg);
            }
            to {
                top: 100vh;
                opacity: 0;
                transform: rotate(720deg);
            }
        }

        @keyframes catAppear {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const translations = {
            ru: {
                rotate: {
                    title: "–ü–æ–≤–µ—Ä–Ω–∏ —ç–∫—Ä–∞–Ω!",
                    subtitle: "–ü–æ–≤–µ—Ä–Ω–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –¥–ª—è –ª—É—á—à–µ–≥–æ –æ–ø—ã—Ç–∞"
                },
                room1: {
                    title: "–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –º–æ–π –ø–æ–∑–¥—Ä–∞–≤–∏—Ç–µ–ª—å–Ω—ã–π —Å–∞–π—Ç-–æ—Ç–∫—Ä—ã—Ç–∫—É! üíù",
                    hint: "–û—Ç—Ç—è–Ω–∏ —Å–µ—Ä–¥–µ—á–∫–æ –∏ –ø–æ–ø–∞–¥–∏ –≤ —Ü–≤–µ—Ç–æ–∫, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å!"
                },
                room2: {
                    title: "–¢–µ–ø–µ—Ä—å –Ω–µ–º–Ω–æ–≥–æ —Ç–µ—Ä–ø–µ–Ω–∏—è!",
                    hint: "–£–¥–µ—Ä–∂–∏ —ç—Ç–æ—Ç —Ü–≤–µ—Ç–æ—á–µ–∫ —Ä–æ–≤–Ω–æ 3 —Å–µ–∫—É–Ω–¥—ã. –ù–µ –ø—Ä–æ–º–∞—Ö–Ω–∏—Å—å! ‚è±Ô∏è"
                },
                room3: {
                    title: "–ê —Ç–µ–ø–µ—Ä—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!",
                    hint: "–¢–∞–ø–∞–π –ø–æ –æ–±–ª–∞—á–∫—É –±—ã—Å—Ç—Ä–æ-–±—ã—Å—Ç—Ä–æ! üëÜ‚ú®",
                    counter: "–¢–∞–ø–æ–≤:"
                },
                room4: {
                    title: "–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!",
                    hint: "–ù–∞–π–¥–∏ —Ç—É —Å–∞–º—É—é –∫–Ω–æ–ø–∫—É... –ü–æ–¥—Å–∫–∞–∑–∫–∞: –æ–Ω–∞ —Å–∞–º–∞—è —è—Ä–∫–∞—è üåü"
                },
                room5: {
                    title: "üå∏ –° 8 –ú–ê–†–¢–ê, –õ–Æ–ë–ò–ú–ê–Ø! üå∏",
                    subtitle: "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø—Ä–æ—à–ª–∞ –≤—Å–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è!",
                    message: "–¢—ã —Å–∞–º–∞—è —Ç–µ—Ä–ø–µ–ª–∏–≤–∞—è, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–∞—è –∏ –º–∏–ª–∞—è üíï",
                    love: "–õ—é–±–ª—é —Ç–µ–±—è! üê±‚ú®"
                }
            },
            en: {
                rotate: {
                    title: "Rotate Your Screen!",
                    subtitle: "Please rotate your phone horizontally for the best experience"
                },
                room1: {
                    title: "Hello! Welcome to my greeting card website! üíù",
                    hint: "Pull the heart and hit the flower to continue!"
                },
                room2: {
                    title: "Now, a bit of patience!",
                    hint: "Hold this flower for exactly 3 seconds. Don't miss! ‚è±Ô∏è"
                },
                room3: {
                    title: "Time for action!",
                    hint: "Tap the cloud quickly! üëÜ‚ú®",
                    counter: "Taps:"
                },
                room4: {
                    title: "Pay attention!",
                    hint: "Find the right button... Hint: it's the brightest one üåü"
                },
                room5: {
                    title: "üå∏ HAPPY MARCH 8TH, MY LOVE! üå∏",
                    subtitle: "Thank you for completing all the challenges!",
                    message: "You're the most patient, attentive, and sweet üíï",
                    love: "I love you! üê±‚ú®"
                }
            }
        };

        function App() {
            const [lang, setLang] = useState('ru');
            const [currentRoom, setCurrentRoom] = useState(1);
            const [showTransition, setShowTransition] = useState(false);
            const [isTelegram, setIsTelegram] = useState(false);

            const t = translations[lang];

            useEffect(() => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –≤ Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    setIsTelegram(true);
                    
                    // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
                    tg.expand();
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
                    tg.setHeaderColor('#1a2456');
                    tg.setBackgroundColor('#0a1128');
                    
                    // –í–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –∑–∞–∫—Ä—ã—Ç–∏—è
                    tg.enableClosingConfirmation();
                }
            }, []);

            const goToNextRoom = () => {
                setShowTransition(true);
                setTimeout(() => {
                    setCurrentRoom(currentRoom + 1);
                    setTimeout(() => setShowTransition(false), 5000); // 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤–∏–¥–µ–æ
                }, 500);
            };

            return (
                <>
                    {currentRoom === 1 && (
                        <div className="lang-switcher">
                            <button 
                                className={`lang-btn ${lang === 'ru' ? 'active' : ''}`}
                                onClick={() => setLang('ru')}
                            >
                                üá∑üá∫ RU
                            </button>
                            <button 
                                className={`lang-btn ${lang === 'en' ? 'active' : ''}`}
                                onClick={() => setLang('en')}
                            >
                                üá¨üáß EN
                            </button>
                        </div>
                    )}

                    {showTransition && <VideoTransition roomNumber={currentRoom} />}
                    
                    {!showTransition && currentRoom === 1 && <Room1 t={t.room1} onComplete={goToNextRoom} />}
                    {!showTransition && currentRoom === 2 && <Room2 t={t.room2} onComplete={goToNextRoom} />}
                    {!showTransition && currentRoom === 3 && <Room3 t={t.room3} onComplete={goToNextRoom} />}
                    {!showTransition && currentRoom === 4 && <Room4 t={t.room4} onComplete={goToNextRoom} />}
                    {!showTransition && currentRoom === 5 && <Room5 t={t.room5} />}
                </>
            );
        }

        function VideoTransition({ roomNumber }) {
            const videoRef = useRef(null);
            
            // –†–µ–∞–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
            const videoFiles = {
                1: 'video_1.mp4',  // –ü–æ—Å–ª–µ –∫–æ–º–Ω–∞—Ç—ã 1: —Ä–æ—Å—Ç–æ–∫ —Ä–∞—Å—Ç—ë—Ç
                2: 'video_2.mp4',  // –ü–æ—Å–ª–µ –∫–æ–º–Ω–∞—Ç—ã 2: —Ü–≤–µ—Ç—ã —Ä–∞—Å–ø—É—Å–∫–∞—é—Ç—Å—è
                3: 'video_3.mp4',  // –ü–æ—Å–ª–µ –∫–æ–º–Ω–∞—Ç—ã 3: –≤–∑—Ä—ã–≤ —Ä–æ—Å—Ç–∞
                4: 'video_4.mp4',  // –ü–æ—Å–ª–µ –∫–æ–º–Ω–∞—Ç—ã 4: –∫–æ—Ç –∏–≥—Ä–∞–µ—Ç
                5: 'video_5.mp4'   // –ü–æ—Å–ª–µ –∫–æ–º–Ω–∞—Ç—ã 5: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤–∑—Ä—ã–≤
            };

            useEffect(() => {
                if (videoRef.current) {
                    videoRef.current.play().catch(err => {
                        console.log('Autoplay prevented:', err);
                    });
                }
            }, []);

            return (
                <div className="video-transition">
                    <video 
                        ref={videoRef}
                        src={videoFiles[roomNumber] || 'video_1.mp4'}
                        autoPlay
                        muted
                        playsInline
                        style={{
                            width: '100%',
                            height: '100%',
                            objectFit: 'cover'
                        }}
                    />
                </div>
            );
        }

        function Room1({ t, onComplete }) {
            const [heartPos, setHeartPos] = useState({ x: 200, y: 400 });
            const [isDragging, setIsDragging] = useState(false);
            const [isFlying, setIsFlying] = useState(false);
            const initialPos = { x: 200, y: 400 };
            const slingshotLeft = 150;
            const slingshotRight = 250;
            const slingshotY = 450; // –ü–æ–¥–Ω—è–ª –≤—ã—à–µ, —á—Ç–æ–±—ã —Å–æ–≤–ø–∞–¥–∞–ª–æ —Å –ª–∏–Ω–∏–µ–π

            const handleStart = (e) => {
                e.preventDefault();
                if (isFlying) return;
                setIsDragging(true);
            };

            const handleMove = (e) => {
                if (!isDragging || isFlying) return;
                e.preventDefault();
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                
                const container = document.querySelector('.slingshot-container');
                if (!container) return;
                
                const rect = container.getBoundingClientRect();
                let x = clientX - rect.left;
                let y = clientY - rect.top;
                
                x = Math.max(slingshotLeft, Math.min(x, slingshotRight));
                y = Math.max(initialPos.y, Math.min(y, 550));
                
                setHeartPos({ x, y });
            };

            const handleEnd = () => {
                if (!isDragging || isFlying) return;
                setIsDragging(false);
                setIsFlying(true);
                
                const deltaX = initialPos.x - heartPos.x;
                const deltaY = initialPos.y - heartPos.y;
                
                const finalX = heartPos.x + deltaX * 2;
                const finalY = heartPos.y + deltaY * 8;
                
                setHeartPos({ x: finalX, y: finalY });
                
                setTimeout(() => {
                    const targetHit = finalX > 120 && finalX < 280 && finalY > 50 && finalY < 150;
                    
                    if (targetHit) {
                        setTimeout(onComplete, 500);
                    } else {
                        setTimeout(() => {
                            setHeartPos(initialPos);
                            setIsFlying(false);
                        }, 500);
                    }
                }, 600);
            };

            return (
                <div className="room-container">
                    <BackgroundFlowers seed={1} />
                    <div className="room-content" style={{ marginTop: '3rem' }}>
                        <h1 className="room-title">{t.title}</h1>
                        <p className="room-hint">{t.hint}</p>
                        <div className="slingshot-container">
                            <div style={{
                                position: 'absolute',
                                left: '50%',
                                transform: 'translateX(-50%)',
                                top: '80px',
                                fontSize: '4rem',
                                animation: 'targetPulse 2s ease-in-out infinite'
                            }}>üå∫</div>
                            
                            <div 
                                style={{
                                    position: 'absolute',
                                    left: `${slingshotLeft}px`,
                                    top: `${slingshotY}px`,
                                    width: `${slingshotRight - slingshotLeft}px`,
                                    height: '6px',
                                    background: 'linear-gradient(90deg, #654321 0%, #8B4513 100%)',
                                    borderRadius: '3px'
                                }}
                            ></div>
                            
                            {isDragging && (
                                <svg 
                                    style={{
                                        position: 'absolute',
                                        top: 0,
                                        left: 0,
                                        width: '100%',
                                        height: '100%',
                                        pointerEvents: 'none'
                                    }}
                                >
                                    <line 
                                        x1={slingshotLeft} 
                                        y1={slingshotY + 3} 
                                        x2={heartPos.x} 
                                        y2={heartPos.y} 
                                        stroke="#FFD700" 
                                        strokeWidth="3"
                                    />
                                    <line 
                                        x1={slingshotRight} 
                                        y1={slingshotY + 3} 
                                        x2={heartPos.x} 
                                        y2={heartPos.y} 
                                        stroke="#FFD700" 
                                        strokeWidth="3"
                                    />
                                </svg>
                            )}
                            
                            <div 
                                className="heart"
                                style={{ 
                                    left: `${heartPos.x - 25}px`, 
                                    top: `${heartPos.y - 25}px`,
                                    transition: isFlying ? 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)' : 'none',
                                    cursor: isDragging ? 'grabbing' : 'grab',
                                    zIndex: 10
                                }}
                                onMouseDown={handleStart}
                                onMouseMove={handleMove}
                                onMouseUp={handleEnd}
                                onMouseLeave={handleEnd}
                                onTouchStart={handleStart}
                                onTouchMove={handleMove}
                                onTouchEnd={handleEnd}
                            >
                                ‚ù§Ô∏è
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function Room2({ t, onComplete }) {
            const [holding, setHolding] = useState(false);
            const [progress, setProgress] = useState(0);
            const [timer, setTimer] = useState(0);

            useEffect(() => {
                if (!holding) {
                    setProgress(0);
                    setTimer(0);
                    return;
                }

                const interval = setInterval(() => {
                    setProgress(prev => {
                        const newProgress = prev + 1;
                        setTimer(newProgress / 100 * 3);
                        
                        if (newProgress >= 100) {
                            clearInterval(interval);
                            setTimeout(onComplete, 500);
                        }
                        
                        return Math.min(newProgress, 100);
                    });
                }, 30);

                return () => clearInterval(interval);
            }, [holding]);

            const handleStart = (e) => {
                e.preventDefault();
                setHolding(true);
            };

            const handleEnd = (e) => {
                e.preventDefault();
                setHolding(false);
            };

            const circumference = 2 * Math.PI * 105;
            const offset = circumference - (progress / 100) * circumference;

            return (
                <div className="room-container">
                    <BackgroundFlowers seed={2} />
                    <div className="room-content">
                        <h1 className="room-title">{t.title}</h1>
                        <p className="room-hint">{t.hint}</p>
                        <div className="hold-button-container">
                            <div className="timer-display">{timer.toFixed(1)}s</div>
                            <div style={{ position: 'relative' }}>
                                <svg className="progress-ring" viewBox="0 0 220 220" style={{ overflow: 'visible' }}>
                                    <circle
                                        className="progress-ring-circle"
                                        cx="110"
                                        cy="110"
                                        r="105"
                                        style={{ strokeDashoffset: offset }}
                                    />
                                </svg>
                                <button 
                                    className="hold-button"
                                    onMouseDown={handleStart}
                                    onMouseUp={handleEnd}
                                    onMouseLeave={handleEnd}
                                    onTouchStart={handleStart}
                                    onTouchEnd={handleEnd}
                                    onContextMenu={(e) => e.preventDefault()}
                                >
                                    üå∏
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function Room3({ t, onComplete }) {
            const [tapCount, setTapCount] = useState(0);
            const [particles, setParticles] = useState([]);
            const [showCat, setShowCat] = useState(false);

            const handleTap = () => {
                setTapCount(prev => {
                    const newCount = prev + 1;
                    if (newCount >= 3 && !showCat) {
                        setShowCat(true);
                    }
                    return newCount;
                });
                
                // –ß–∞—Å—Ç–∏—Ü—ã –≤—ã–ª–µ—Ç–∞—é—Ç –ò–ó –¶–ï–ù–¢–†–ê –æ–±–ª–∞–∫–∞
                const newParticles = ['üå∏', 'üå∫', 'üåª', 'üå∑', 'üíê'].map((emoji, i) => ({
                    id: Date.now() + i,
                    emoji,
                    startLeft: 50,
                    endLeft: 30 + Math.random() * 40,
                    angle: Math.random() * 360
                }));
                
                setParticles(prev => [...prev, ...newParticles]);
                
                setTimeout(() => {
                    setParticles(prev => prev.filter(p => !newParticles.find(np => np.id === p.id)));
                }, 2000);
            };

            useEffect(() => {
                if (tapCount >= 20) {
                    setTimeout(onComplete, 1000);
                }
            }, [tapCount]);

            return (
                <div className="room-container">
                    <BackgroundFlowers seed={3} />
                    {showCat && (
                        <div style={{
                            position: 'fixed',
                            bottom: '20px',
                            left: '20px',
                            fontSize: '4rem',
                            zIndex: 500,
                            animation: 'catAppear 0.5s ease-out'
                        }}>
                            üê±
                        </div>
                    )}
                    <div className="room-content">
                        <h1 className="room-title">{t.title}</h1>
                        <p className="room-hint">{t.hint}</p>
                        <div className="shake-container">
                            <button
                                onClick={handleTap}
                                style={{
                                    position: 'relative',
                                    fontSize: '8rem',
                                    background: 'none',
                                    border: 'none',
                                    cursor: 'pointer',
                                    animation: 'cloudFloat 3s ease-in-out infinite'
                                }}
                            >
                                ‚òÅÔ∏è
                                {/* –ß–∞—Å—Ç–∏—Ü—ã –≤—ã–ª–µ—Ç–∞—é—Ç –∏–∑ –æ–±–ª–∞–∫–∞ */}
                                {particles.map(particle => (
                                    <div
                                        key={particle.id}
                                        style={{
                                            position: 'absolute',
                                            fontSize: '2rem',
                                            left: '50%',
                                            top: '50%',
                                            transform: 'translate(-50%, -50%)',
                                            animation: `fallFromCloud 2s ease-in forwards`,
                                            '--end-x': `${(particle.endLeft - 50) * 2}vw`,
                                            '--rotation': `${particle.angle}deg`
                                        }}
                                    >
                                        {particle.emoji}
                                    </div>
                                ))}
                            </button>
                            <div className="shake-counter">{t.counter} {tapCount} / 20</div>
                        </div>
                    </div>
                </div>
            );
        }

        function Room4({ t, onComplete }) {
            const [buttons, setButtons] = useState([]);
            const [correctIndex] = useState(4);
            const [correctClicks, setCorrectClicks] = useState(0);

            useEffect(() => {
                const colors = [
                    'linear-gradient(135deg, #667eea, #764ba2)',
                    'linear-gradient(135deg, #f093fb, #f5576c)',
                    'linear-gradient(135deg, #4facfe, #00f2fe)',
                    'linear-gradient(135deg, #43e97b, #38f9d7)',
                    'linear-gradient(135deg, #fa709a, #fee140)',
                    'linear-gradient(135deg, #30cfd0, #330867)',
                    'linear-gradient(135deg, #a8edea, #fed6e3)',
                    'linear-gradient(135deg, #ff9a9e, #fecfef)',
                    'linear-gradient(135deg, #ffecd2, #fcb69f)'
                ];
                
                setButtons(colors.map((color, i) => ({
                    id: i,
                    color,
                    emoji: ['üî¥', 'üü†', 'üü°', 'üü¢', '‚≠ê', 'üîµ', 'üü£', 'üü§', '‚ö™'][i],
                    correct: i === correctIndex,
                    position: { x: 0, y: 0 },
                    permanentPosition: { x: 0, y: 0 }
                })));
            }, []);

            const handleButtonClick = (button, index, e) => {
                e.preventDefault();
                
                if (button.correct) {
                    const newClicks = correctClicks + 1;
                    setCorrectClicks(newClicks);
                    
                    if (newClicks >= 5) {
                        setTimeout(onComplete, 500);
                    } else {
                        // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —É–±–µ–≥–∞–µ—Ç –≤ —Å–ª—É—á–∞–π–Ω–æ–µ –º–µ—Å—Ç–æ –ù–ê–í–°–ï–ì–î–ê
                        const angle = Math.random() * Math.PI * 2;
                        const distance = 100 + Math.random() * 150;
                        const newX = Math.cos(angle) * distance;
                        const newY = Math.sin(angle) * distance;
                        
                        setButtons(prev => prev.map((b, i) => 
                            i === index 
                                ? { 
                                    ...b, 
                                    position: { x: newX, y: newY },
                                    permanentPosition: { x: newX, y: newY }
                                }
                                : b
                        ));
                    }
                } else {
                    // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ —É–±–µ–≥–∞–µ—Ç –∏ –í–û–ó–í–†–ê–©–ê–ï–¢–°–Ø
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 50 + Math.random() * 100;
                    const newX = Math.cos(angle) * distance;
                    const newY = Math.sin(angle) * distance;
                    
                    setButtons(prev => prev.map((b, i) => 
                        i === index 
                            ? { ...b, position: { x: newX, y: newY } }
                            : b
                    ));
                    
                    setTimeout(() => {
                        setButtons(prev => prev.map((b, i) => 
                            i === index 
                                ? { ...b, position: b.permanentPosition }
                                : b
                        ));
                    }, 600);
                }
            };

            return (
                <div className="room-container">
                    <BackgroundFlowers seed={4} />
                    <div className="room-content">
                        <h1 className="room-title">{t.title}</h1>
                        <p className="room-hint">{t.hint}</p>
                        <div className="buttons-grid">
                            {buttons.map((button, index) => (
                                <button
                                    key={button.id}
                                    className="game-button"
                                    style={{
                                        background: button.color,
                                        transform: `translate(${button.position.x}px, ${button.position.y}px)`,
                                        boxShadow: button.correct 
                                            ? '0 0 20px rgba(255, 215, 0, 0.6)' 
                                            : '0 5px 15px rgba(0, 0, 0, 0.3)',
                                        transition: 'transform 0.5s ease-out, box-shadow 0.3s'
                                    }}
                                    onClick={(e) => handleButtonClick(button, index, e)}
                                    onContextMenu={(e) => e.preventDefault()}
                                >
                                    {button.emoji}
                                </button>
                            ))}
                        </div>
                        {correctClicks > 0 && (
                            <div style={{ 
                                marginTop: '2rem', 
                                fontSize: '1.5rem', 
                                color: '#FFD700',
                                textShadow: '0 0 10px rgba(255, 215, 0, 0.8)'
                            }}>
                                {correctClicks} / 5
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function Room5({ t }) {
            const [showMessage, setShowMessage] = useState(false);
            const [confetti, setConfetti] = useState([]);

            const handleClick = () => {
                setShowMessage(true);
                
                const newConfetti = Array.from({ length: 100 }, (_, i) => ({
                    id: i,
                    left: Math.random() * 100,
                    delay: Math.random() * 2,
                    color: ['#ff6b9d', '#ffc371', '#c471ed', '#12c2e9', '#f093fb'][Math.floor(Math.random() * 5)]
                }));
                
                setConfetti(newConfetti);
            };

            return (
                <div className="room-container">
                    <BackgroundFlowers dense seed={5} />
                    <div className="room-content">
                        {!showMessage ? (
                            <>
                                <h1 className="room-title">{t.title}</h1>
                                <div className="final-flower" onClick={handleClick}>üåπ</div>
                            </>
                        ) : (
                            <div style={{ textAlign: 'center', padding: '0 1rem' }}>
                                <h1 className="room-title" style={{ fontSize: 'clamp(2rem, 6vw, 3rem)' }}>{t.title}</h1>
                                <p className="room-hint" style={{ fontSize: 'clamp(1rem, 3vw, 1.3rem)', marginBottom: '1rem' }}>
                                    {t.subtitle}
                                </p>
                                <p className="room-hint" style={{ fontSize: 'clamp(0.95rem, 2.5vw, 1.2rem)', marginBottom: '1.5rem' }}>
                                    {t.message}
                                </p>
                                <div className="final-message" style={{ fontSize: 'clamp(1.8rem, 5vw, 2.5rem)' }}>{t.love}</div>
                                <div style={{ fontSize: '4rem', marginTop: '1.5rem' }}>üê±‚ú®</div>
                            </div>
                        )}
                        {confetti.map(c => (
                            <div
                                key={c.id}
                                className="confetti"
                                style={{
                                    left: `${c.left}%`,
                                    background: c.color,
                                    animationDelay: `${c.delay}s`
                                }}
                            />
                        ))}
                    </div>
                </div>
            );
        }

        function BackgroundFlowers({ dense, seed = 0 }) {
            const flowers = ['üå∏', 'üå∫', 'üåª', 'üå∑', 'üåπ'];
            const count = dense ? 20 : 10;
            
            // Use seed to generate consistent random positions
            const seededRandom = (s) => {
                const x = Math.sin(s++) * 10000;
                return x - Math.floor(x);
            };
            
            const flowerPositions = React.useMemo(() => {
                return Array.from({ length: count }, (_, i) => ({
                    left: seededRandom(seed * 100 + i * 2) * 100,
                    top: seededRandom(seed * 100 + i * 2 + 1) * 100,
                    delay: seededRandom(seed * 100 + i * 2 + 2) * 6,
                    size: 2 + seededRandom(seed * 100 + i * 2 + 3) * 2,
                    flower: flowers[Math.floor(seededRandom(seed * 100 + i * 2 + 4) * flowers.length)]
                }));
            }, [seed, count]);
            
            return (
                <div className="room-bg">
                    {flowerPositions.map((pos, i) => (
                        <div
                            key={i}
                            className="flower"
                            style={{
                                left: `${pos.left}%`,
                                top: `${pos.top}%`,
                                animationDelay: `${pos.delay}s`,
                                fontSize: `${pos.size}rem`
                            }}
                        >
                            {pos.flower}
                        </div>
                    ))}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
